\documentclass{book}
% generated by Madoko, version 0.9.5-beta
%mdk-data-line={1}

\usepackage{option}


\begin{document}

\section{Introduction}

\makeatletter

\def\famcmd{}

\optionset{%
  /fama/width/.new length   =5pt,
  /fama/sep/.new dim      =\fboxsep + \fboxrule,
  /famb/width/.new length   =1pt,
  /famc/widthc/.new length  =3pt,
  /fama/testa/.new value    =fifteen,
  /fam/cmd/.is def          =\famcmd,
  /fam/counter/.is counter  =section,
  /fam/num/.new num          = 0,
  /fam/side/.new choice      ={top,right,bottom,left},
  /fam/test/.new cmd        =\typeout{test received #1, \detokenize{#1}},
  /fam/.new family=/fama,
  /fam/members/.new list={a,b,c},
}

\optionset{%
  /fama/width=\fboxsep + \fboxrule,
  /fam/sep=12pt,
  /fam,
  side=right,
  cmd/.expands,
  cmd={hi there \the\fboxrule},
  test=\option{/fama/testa},
  test/.expand once=\option{/fama/testa},
  test/.expand twice=\option{/fama/testa},
  test/.expanded=\option{/fama/testa},
  members/.expand once/.push=\option{/fam/cmd},
  /fam/num/.add=2,
  /fam/counter/.add=4,
}

\letoption{/fam/members}\opt@list
\typeout{list: \meaning\opt@list}

\ifcase\option{/fam/side/@ord}
  the top
\or
  the right
\or
  other
\fi

\if\option{/fam/side/@tag}r\relax
  it's right
\else
  or not
\fi

\typeout{section counter: \roman{\option{/fam/counter}}}
\optionshowall



\end{document}



\newrobustcmd*\test[1]{%
  \option@splitkey{#1}%
}

\test{/fam/key}
\test{/key}
\test{key}
\test{/.ignore}
\test{/fam/sub/key}
\test{/fam/sub/key/.ignore}
\test{}
\test{/}
\test{foo/key}
\test{//key}
\test{//fam/key}
\test{//}
\test{///}
\test{////key}
\end{document}

\end{document}

\option@findinkeypath{/fbox}{.unknown}
\option@findinkeypath{/fbox/}{.unknown}
\option@findinkeypath{/fbox/foo}{.unknown}
\option@findinkeypath{/fbox/border}{.unknown}
\option@findinkeypath{/fbox/border/left}{.unknown}
\option@findinkeypath{/fbox/border/left/width}{.unknown}
\option@findinkeypath{/fbox/xborder/left}{.unknown}
\option@findinkeypath{/fbox/xborder/left/width}{.unknown}
\option@findinkeypath{/}{.unknown}
\option@findinkeypath{/foo}{.unknown}
%\option@findinkeypath{}{.unknown}
\option@findinkeypath{/fbox/border/left/}{.unknown}
\option@findinkeypath{/fbox/border/left//}{.unknown}



\end{document}

\option@splitroot{fooyes!}
\typeout{ split: "\option@root","\option@subpath"}

\iffalse
\newcount\@loop
\def\do#1#2#3{\letoption{#2#3/.searchalso}\opt@trykey\ifx\opt@trykey\relax\else\def\opt@found{found}\fi}%
\def\option@foreachparent#1{%
  \option@splitroot{#1}\do{\option@root}{\option@subpath}{}%
}
\def\opt@testforeach{%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \option@foreachparent{/fbox/border/left/style}%
  \advance\@loop 1\relax
}
\@whilenum\@loop<25000\do\opt@testforeach
\fi

\end{document}


\end{document}

